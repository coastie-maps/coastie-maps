<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <script src="https://maps.secondlife.com/_scripts/sl.mapapi2.js"></script>
    <link rel="stylesheet" type="text/css" href="https://maps.secondlife.com/_styles/sl.mapapi2.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>

    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>


    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        div#map-container {
            width: 100%;
            height: 100%;
        }
    </style>

    <script>
        function loadmap() {
            var lmap = new SLMap(document.getElementById('map-container'));
            lmap.setView([1002, 997], 3);
            const clusterGroup = L.markerClusterGroup({
                maxClusterRadius: 50,
                spiderfyOnMaxZoom: true,
                showCoverageOnHover: false,
                zoomToBoundsOnClick: true,
                chunkedLoading: true
            });

            fetch('stations.json')
                .then(response => response.json())
                .then(stations => {

                    stations.forEach(station => {
                        var icon = L.icon({
                            iconUrl: "marker/" + station.marker,
                            iconSize: [30, 40]
                        });

                        var marker = L.marker(
                            [station.grid_pos[1], station.grid_pos[0]],
                            { icon: icon }
                        ).addTo(lmap);

                        marker.bindTooltip(station.name, {
                            permanent: false,
                            direction: "top"
                        });

                        marker.bindPopup(
                            "<b>" + station.name + "</b><br>" +
                            "<a href='" + station.url + "' target='_blank'>Teleport</a>"
                        );
                        clusterGroup.addLayer(marker);
                        
                    });

                })
                .catch(err => console.error("failed to load resources", err));
            lmap.addLayer(clusterGroup);
        }
    </script>
</head>

<body onload="loadmap()">
    <div id="map-container"></div>
</body>
</html>

